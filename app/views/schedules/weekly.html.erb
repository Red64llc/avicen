<div class="max-w-6xl mx-auto">
  <h1 class="text-2xl font-bold text-gray-900 mb-2">Weekly Schedule</h1>

  <%# Week navigation %>
  <div class="flex items-center justify-between mb-6">
    <%= link_to weekly_schedule_path(week_start: @previous_week_start.to_s),
        class: "inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",
        aria: { label: "Previous week" } do %>
      <svg class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg>
      Prev
    <% end %>

    <div class="text-center">
      <p class="text-lg font-semibold text-gray-900">
        <%= @week_start.strftime("%B %-d") %> &ndash; <%= (@week_start + 6.days).strftime("%B %-d, %Y") %>
      </p>
    </div>

    <%= link_to weekly_schedule_path(week_start: @next_week_start.to_s),
        class: "inline-flex items-center px-3 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",
        aria: { label: "Next week" } do %>
      Next
      <svg class="h-4 w-4 ml-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg>
    <% end %>
  </div>

  <%# Weekly overview in Turbo Frame %>
  <%= turbo_frame_tag "weekly_schedule" do %>
    <div class="grid grid-cols-1 md:grid-cols-7 gap-3">
      <% @day_summaries.each do |day_summary| %>
        <div class="bg-white rounded-lg shadow-sm border overflow-hidden
          <%= case day_summary.adherence_status
              when :complete then 'border-green-300'
              when :partial then 'border-yellow-300'
              when :none then 'border-red-300'
              else 'border-gray-200'
              end %>">

          <%# Day header with adherence indicator %>
          <div class="px-3 py-2 border-b
            <%= case day_summary.adherence_status
                when :complete then 'bg-green-50 border-green-200'
                when :partial then 'bg-yellow-50 border-yellow-200'
                when :none then 'bg-red-50 border-red-200'
                else 'bg-gray-50 border-gray-200'
                end %>">
            <p class="text-sm font-semibold text-gray-900">
              <%= day_summary.date.strftime("%a") %>
            </p>
            <p class="text-xs text-gray-600">
              <%= day_summary.date.strftime("%b %-d") %>
            </p>
            <% if day_summary.total_scheduled > 0 %>
              <p class="mt-1 text-xs font-medium
                <%= case day_summary.adherence_status
                    when :complete then 'text-green-700'
                    when :partial then 'text-yellow-700'
                    when :none then 'text-red-700'
                    end %>">
                <% case day_summary.adherence_status %>
                <% when :complete %>
                  Complete (<%= day_summary.total_logged %>/<%= day_summary.total_scheduled %>)
                <% when :partial %>
                  Partial (<%= day_summary.total_logged %>/<%= day_summary.total_scheduled %>)
                <% when :none %>
                  None (<%= day_summary.total_logged %>/<%= day_summary.total_scheduled %>)
                <% end %>
              </p>
            <% end %>
          </div>

          <%# Medication entries for the day %>
          <div class="px-3 py-2 space-y-2">
            <% if day_summary.entries.empty? %>
              <p class="text-xs text-gray-400 italic">No medications</p>
            <% else %>
              <% day_summary.entries.each do |entry| %>
                <div class="text-xs">
                  <div class="flex items-center justify-between gap-1">
                    <span class="font-medium text-gray-900 truncate"><%= entry.drug_name %></span>
                    <span class="flex-shrink-0
                      <% case entry.status %>
                      <% when :taken %>
                        text-green-600
                      <% when :skipped %>
                        text-yellow-600
                      <% when :pending %>
                        text-gray-400
                      <% end %>">
                      <% case entry.status %>
                      <% when :taken %>
                        <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                          <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                      <% when :skipped %>
                        <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                      <% when :pending %>
                        <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" />
                        </svg>
                      <% end %>
                    </span>
                  </div>
                  <p class="text-gray-500"><%= entry.schedule.time_of_day %> &middot; <%= entry.dosage %></p>
                </div>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
